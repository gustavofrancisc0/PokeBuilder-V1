<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tradutor de Habilidades Pok√©mon</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      }

      h1 {
        color: #11998e;
        margin-bottom: 10px;
        font-size: 2.5em;
      }

      .subtitle {
        color: #666;
        margin-bottom: 30px;
      }

      .section {
        margin-bottom: 30px;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 12px;
      }

      .section h2 {
        color: #333;
        margin-bottom: 15px;
        font-size: 1.3em;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .section h2 .step {
        background: #11998e;
        color: white;
        width: 30px;
        height: 30px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.9em;
      }

      .btn {
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
        font-weight: 600;
        transition: all 0.3s;
        margin-right: 10px;
        margin-bottom: 10px;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(17, 153, 142, 0.4);
      }

      .btn:disabled {
        background: #ccc;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      .btn.danger {
        background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
      }

      .btn.secondary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }

      .progress {
        margin-top: 20px;
        padding: 15px;
        background: #fff;
        border-radius: 8px;
        border: 1px solid #e0e0e0;
        display: none;
      }

      .progress.active {
        display: block;
      }

      .progress-bar {
        height: 30px;
        background: #e0e0e0;
        border-radius: 15px;
        overflow: hidden;
        margin: 10px 0;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #11998e, #38ef7d);
        transition: width 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        font-size: 14px;
      }

      .stats-bar {
        display: flex;
        gap: 20px;
        margin-top: 15px;
        flex-wrap: wrap;
      }

      .stat-item {
        background: #11998e;
        color: white;
        padding: 10px 20px;
        border-radius: 20px;
        font-weight: 600;
      }

      .log {
        background: #1e1e1e;
        color: #00ff00;
        padding: 20px;
        border-radius: 8px;
        font-family: "Courier New", monospace;
        font-size: 13px;
        max-height: 350px;
        overflow-y: auto;
        margin-top: 20px;
      }

      .log-entry {
        margin-bottom: 5px;
        padding: 2px 0;
      }

      .info {
        color: #00bfff;
      }
      .success {
        color: #00ff00;
      }
      .error {
        color: #ff4444;
      }
      .warning {
        color: #ffaa00;
      }

      .info-box {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        border-radius: 12px;
        margin-bottom: 30px;
      }

      .info-box h3 {
        margin-bottom: 10px;
      }

      .info-box ul {
        margin-left: 20px;
      }

      .info-box li {
        margin: 5px 0;
      }

      .file-input-wrapper {
        display: inline-block;
      }

      .file-input-wrapper input[type="file"] {
        display: none;
      }

      .preview-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
        font-size: 14px;
      }

      .preview-table th,
      .preview-table td {
        padding: 10px;
        text-align: left;
        border-bottom: 1px solid #e0e0e0;
      }

      .preview-table th {
        background: #11998e;
        color: white;
      }

      .preview-table tr:hover {
        background: #f5f5f5;
      }

      .preview-container {
        max-height: 300px;
        overflow-y: auto;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        margin-top: 15px;
        display: none;
      }

      .preview-container.active {
        display: block;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>‚ú® Tradutor de Habilidades Pok√©mon</h1>
      <p class="subtitle">
        Gere e traduza automaticamente as descri√ß√µes das habilidades (Abilities)
      </p>

      <div class="info-box">
        <h3>üìã Como usar:</h3>
        <ul>
          <li>
            <strong>Passo 1:</strong> Busque todas as habilidades da Pok√©API
          </li>
          <li><strong>Passo 2:</strong> Baixe o arquivo JSON em ingl√™s</li>
          <li>
            <strong>Passo 3:</strong> Traduza automaticamente ou manualmente
          </li>
          <li>
            <strong>Passo 4:</strong> Baixe o arquivo traduzido
            (abilities-pt.json)
          </li>
          <li><strong>Passo 5:</strong> Use no seu projeto!</li>
        </ul>
      </div>

      <div class="section">
        <h2><span class="step">1</span> Buscar Habilidades da API</h2>
        <button class="btn" id="fetchBtn" onclick="fetchAllAbilities()">
          üì• Buscar Todas as Habilidades
        </button>
        <button
          class="btn secondary"
          id="downloadEnBtn"
          onclick="downloadJSON('en')"
          disabled
        >
          üíæ Baixar abilities-en.json
        </button>

        <div class="preview-container" id="previewEn">
          <table class="preview-table">
            <thead>
              <tr>
                <th>Nome</th>
                <th>Descri√ß√£o (EN)</th>
              </tr>
            </thead>
            <tbody id="previewEnBody"></tbody>
          </table>
        </div>
      </div>

      <div class="section">
        <h2><span class="step">2</span> Traduzir Automaticamente</h2>
        <p style="color: #666; margin-bottom: 15px">
          ‚ö†Ô∏è A tradu√ß√£o autom√°tica usa a API MyMemory (gratuita). Pode levar
          alguns minutos e tem limite de requisi√ß√µes.
        </p>
        <button
          class="btn"
          id="translateBtn"
          onclick="translateAbilities()"
          disabled
        >
          üåê Traduzir para Portugu√™s
        </button>
        <button
          class="btn danger"
          id="stopBtn"
          onclick="stopTranslation()"
          disabled
        >
          ‚è∏Ô∏è Parar Tradu√ß√£o
        </button>
        <button
          class="btn secondary"
          id="downloadPtBtn"
          onclick="downloadJSON('pt')"
          disabled
        >
          üíæ Baixar abilities-pt.json
        </button>
      </div>

      <div class="section">
        <h2><span class="step">3</span> Continuar Tradu√ß√£o (Opcional)</h2>
        <p style="color: #666; margin-bottom: 15px">
          Se a tradu√ß√£o parou no meio, carregue o arquivo parcial e continue de
          onde parou.
        </p>
        <div class="file-input-wrapper">
          <input
            type="file"
            id="uploadPt"
            accept=".json"
            onchange="loadExistingTranslations(event)"
          />
          <button
            class="btn secondary"
            onclick="document.getElementById('uploadPt').click()"
          >
            üìÇ Carregar abilities-pt.json Parcial
          </button>
        </div>
        <button
          class="btn"
          id="continueBtn"
          onclick="continueTranslation()"
          disabled
        >
          ‚ñ∂Ô∏è Continuar Tradu√ß√£o
        </button>
      </div>

      <div class="progress" id="progress">
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill">0%</div>
        </div>
        <p id="progressText">Preparando...</p>
        <div class="stats-bar">
          <span class="stat-item" id="statTotal">Total: 0</span>
          <span class="stat-item" id="statProcessed">Processados: 0</span>
          <span class="stat-item" id="statRemaining">Restantes: 0</span>
        </div>
      </div>

      <div class="log" id="log"></div>
    </div>

    <script>
      const API_BASE = "https://pokeapi.co/api/v2";
      let abilitiesDataEN = {};
      let abilitiesDataPT = {};
      let shouldStop = false;

      function log(message, type = "info") {
        const logEl = document.getElementById("log");
        const entry = document.createElement("div");
        entry.className = `log-entry ${type}`;
        const time = new Date().toLocaleTimeString();
        entry.textContent = `[${time}] ${message}`;
        logEl.appendChild(entry);
        logEl.scrollTop = logEl.scrollHeight;
      }

      function updateProgress(current, total) {
        const percent = Math.round((current / total) * 100);
        document.getElementById("progressFill").style.width = percent + "%";
        document.getElementById("progressFill").textContent = percent + "%";
        document.getElementById(
          "progressText"
        ).textContent = `Processando ${current} de ${total} habilidades...`;
        document.getElementById("statTotal").textContent = `Total: ${total}`;
        document.getElementById(
          "statProcessed"
        ).textContent = `Processados: ${current}`;
        document.getElementById("statRemaining").textContent = `Restantes: ${
          total - current
        }`;
      }

      function stopTranslation() {
        shouldStop = true;
        log(
          "‚è∏Ô∏è Parando tradu√ß√£o... Aguarde o t√©rmino da requisi√ß√£o atual.",
          "warning"
        );
        document.getElementById("stopBtn").disabled = true;
      }

      function loadExistingTranslations(event) {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function (e) {
          try {
            const loaded = JSON.parse(e.target.result);
            abilitiesDataPT = loaded;
            const count = Object.keys(loaded).length;
            log(`‚úÖ Carregadas ${count} habilidades j√° traduzidas!`, "success");

            const lastKey = Object.keys(loaded)[count - 1];
            log(`üìç √öltima habilidade: ${lastKey}`, "info");

            document.getElementById("continueBtn").disabled = false;
            document.getElementById("downloadPtBtn").disabled = false;
          } catch (error) {
            log("‚ùå Erro ao ler arquivo JSON: " + error.message, "error");
          }
        };
        reader.readAsText(file);
      }

      async function fetchAllAbilities() {
        document.getElementById("fetchBtn").disabled = true;
        document.getElementById("progress").classList.add("active");
        log("üîÑ Iniciando busca de habilidades...", "info");

        try {
          // Buscar lista de todas as habilidades
          log("üì° Conectando √† Pok√©API...", "info");
          const response = await fetch(`${API_BASE}/ability?limit=500`);
          const data = await response.json();

          log(`‚úÖ Encontradas ${data.results.length} habilidades!`, "success");

          abilitiesDataEN = {};
          let processed = 0;
          const total = data.results.length;

          // Buscar detalhes de cada habilidade
          for (const ability of data.results) {
            try {
              const abilityResponse = await fetch(ability.url);
              const abilityData = await abilityResponse.json();

              // Pegar a descri√ß√£o em ingl√™s (efeito curto ou flavor text)
              const LongEffect = abilityData.effect_entries.find(
                (e) => e.language.name === "en"
              )?.effect;

              const shortEffect = abilityData.effect_entries.find(
                (e) => e.language.name === "en"
              )?.short_effect;

              const flavorText = abilityData.flavor_text_entries.find(
                (e) => e.language.name === "en"
              )?.flavor_text;

              const description =
                LongEffect ||
                shortEffect ||
                flavorText ||
                "No description available";

              // Limpar a descri√ß√£o
              const cleanDescription = description
                .replace(/\n/g, " ")
                .replace(/\s+/g, " ")
                .trim();

              abilitiesDataEN[abilityData.name] = cleanDescription;

              processed++;
              updateProgress(processed, total);

              if (processed % 25 === 0) {
                log(
                  `üì¶ Processadas ${processed}/${total} habilidades...`,
                  "info"
                );
              }

              // Pequeno delay para n√£o sobrecarregar a API
              await new Promise((resolve) => setTimeout(resolve, 50));
            } catch (error) {
              log(
                `‚ö†Ô∏è Erro ao buscar ${ability.name}: ${error.message}`,
                "warning"
              );
            }
          }

          log(
            `‚úÖ Busca conclu√≠da! ${processed} habilidades carregadas`,
            "success"
          );

          document.getElementById("downloadEnBtn").disabled = false;
          document.getElementById("translateBtn").disabled = false;

          // Mostrar preview
          showPreview();
        } catch (error) {
          log(`‚ùå Erro fatal: ${error.message}`, "error");
        }

        document.getElementById("fetchBtn").disabled = false;
      }

      function showPreview() {
        const tbody = document.getElementById("previewEnBody");
        tbody.innerHTML = "";

        const entries = Object.entries(abilitiesDataEN).slice(0, 20);
        entries.forEach(([name, desc]) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td><strong>${formatName(name)}</strong></td>
            <td>${desc.substring(0, 100)}${desc.length > 100 ? "..." : ""}</td>
          `;
          tbody.appendChild(tr);
        });

        document.getElementById("previewEn").classList.add("active");
      }

      function formatName(name) {
        return name
          .split("-")
          .map((word) => word.charAt(0).toUpperCase() + word.slice(1))
          .join(" ");
      }

      async function translateAbilities(continueFromExisting = false) {
        if (Object.keys(abilitiesDataEN).length === 0) {
          log("‚ö†Ô∏è Primeiro busque as habilidades!", "warning");
          return;
        }

        shouldStop = false;
        document.getElementById("translateBtn").disabled = true;
        document.getElementById("stopBtn").disabled = false;
        document.getElementById("progress").classList.add("active");

        log("üåê Iniciando tradu√ß√£o autom√°tica...", "info");

        const abilities = Object.entries(abilitiesDataEN);
        const total = abilities.length;
        let processed = 0;
        let translated = 0;
        let skipped = 0;

        for (const [name, description] of abilities) {
          if (shouldStop) {
            log(`‚è∏Ô∏è Tradu√ß√£o pausada em ${processed}/${total}`, "warning");
            break;
          }

          // Pular se j√° foi traduzido
          if (continueFromExisting && abilitiesDataPT[name]) {
            processed++;
            skipped++;
            updateProgress(processed, total);
            continue;
          }

          try {
            // Traduzir usando API gratuita MyMemory
            const url = `https://api.mymemory.translated.net/get?q=${encodeURIComponent(
              description
            )}&langpair=en|pt-br`;

            const response = await fetch(url);
            const data = await response.json();

            if (data.responseStatus === 200) {
              abilitiesDataPT[name] =
                data.responseData.translatedText || description;
              translated++;
            } else {
              // Se exceder o limite, manter em ingl√™s
              abilitiesDataPT[name] = description;
              if (data.responseStatus === 429) {
                log("‚ö†Ô∏è Limite de API atingido. Aguardando...", "warning");
                await new Promise((resolve) => setTimeout(resolve, 5000));
              }
            }

            processed++;
            updateProgress(processed, total);

            if (processed % 10 === 0) {
              log(
                `üîÑ Traduzidas ${translated}/${processed} (${skipped} puladas)...`,
                "info"
              );
              // Delay para respeitar rate limit
              await new Promise((resolve) => setTimeout(resolve, 1500));
            } else {
              await new Promise((resolve) => setTimeout(resolve, 300));
            }
          } catch (error) {
            log(`‚ö†Ô∏è Erro ao traduzir ${name}: ${error.message}`, "warning");
            abilitiesDataPT[name] = description; // Manter em ingl√™s se falhar
            processed++;
            updateProgress(processed, total);
          }
        }

        log(`‚úÖ Tradu√ß√£o ${shouldStop ? "pausada" : "conclu√≠da"}!`, "success");
        log(
          `üìä Total: ${processed} | Traduzidas: ${translated} | Puladas: ${skipped}`,
          "info"
        );

        document.getElementById("downloadPtBtn").disabled = false;
        document.getElementById("translateBtn").disabled = false;
        document.getElementById("stopBtn").disabled = true;
        shouldStop = false;
      }

      function continueTranslation() {
        if (Object.keys(abilitiesDataEN).length === 0) {
          log("‚ö†Ô∏è Primeiro busque as habilidades!", "warning");
          return;
        }
        translateAbilities(true);
      }

      function downloadJSON(type) {
        const data = type === "en" ? abilitiesDataEN : abilitiesDataPT;
        const filename = `abilities-${type}.json`;
        const count = Object.keys(data).length;

        if (count === 0) {
          log("‚ö†Ô∏è Nenhum dado para baixar!", "warning");
          return;
        }

        const blob = new Blob([JSON.stringify(data, null, 2)], {
          type: "application/json",
        });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = filename;
        a.click();
        URL.revokeObjectURL(url);

        log(
          `‚úÖ Download de ${filename} iniciado! (${count} habilidades)`,
          "success"
        );
      }
    </script>
  </body>
</html>
